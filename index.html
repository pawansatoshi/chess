<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monad Testnet Chess</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/css/chessboard.min.css">
<style>
body { background-color:#0a0a0a; color:#fff; font-family: Arial,sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px;}
.header{display:flex;align-items:center;gap:20px;margin-bottom:20px;}
.header img{height:60px;}
#board{width:400px;margin-bottom:20px;}
.controls button, .socials button{padding:10px 16px;margin:5px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;}
.controls button{background-color:#1a73e8;color:#fff;}
.controls button:hover{background-color:#155ab6;}
.socials button{background-color:#00acee;color:#fff;}
.socials button:hover{background-color:#0077b5;}
.socials span{display:inline-block;margin:5px;font-weight:bold;}
</style>
</head>
<body>

<div class="header">
<img src="monad_logo.png" alt="Monad Logo">
<h1>Monad Testnet Chess</h1>
<img src="fox_logo.png" alt="Fox Logo">
</div>

<div class="socials">
<button onclick="window.open('https://t.me/pawansatoshiji','_blank')">Telegram</button>
<button onclick="window.open('https://youtube.com/@PawanSatoshi','_blank')">YouTube</button>
<button onclick="window.open('https://x.com/pawansatoshix','_blank')">X</button>
<span>Discord: @pawansatoshi</span>
</div>

<div id="board"></div>

<div class="controls">
<button id="connectBtn">Connect Wallet</button>
<button id="addNetworkBtn">Add Monad Testnet</button>
<button id="startBtn">Start New Game</button>
<button id="joinBtn">Join Game as Black</button>
<button id="resetBtn">Reset Board</button>
</div>

<div id="status">Connect your wallet to start</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/js/chessboard.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script src="https://unpkg.com/stockfish/stockfish.js"></script>

<script>
// === Chess.js setup ===
const game = new Chess();
let humanColor = 'w';
let aiColor = 'b';
const board = Chessboard('board', {
  position: 'start',
  draggable: true,
  pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png',
  onDragStart: (source, piece) => {
    if (game.game_over()) return false;
    if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
        (game.turn() === 'b' && piece.search(/^w/) !== -1)) return false;
  },
  onDrop: async (source, target) => {
    const move = game.move({ from: source, to: target, promotion: 'q' });
    if (move === null) return 'snapback';
    board.position(game.fen());
    console.log('Human move:', move.san);
    await submitMoveOnChain(move.san, humanColor);
    if (!game.game_over()) aiMove();
  },
  onSnapEnd: () => { board.position(game.fen()); }
});

// === Ethers.js + Monad Testnet ===
let provider, signer, contract, aiSigner;
const contractAddress = '0x927E5DF0b0a5971cA625051C4116A2515525dCEb';
const contractABI = [ /* Paste your full ABI here */ ];

// Private key for AI
const AI_PRIVATE_KEY = '0xe899225a15a4c31e373d2c3dcf9f567903c90817c3af31cd2dd9b22c9e6a0f3c';

async function connectWallet(){
  if(window.ethereum){
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    contract = new ethers.Contract(contractAddress, contractABI, signer);
    document.getElementById('status').innerText = 'Wallet connected';
  } else {
    provider = new ethers.providers.JsonRpcProvider("https://testnet-rpc.monad.xyz");
    contract = new ethers.Contract(contractAddress, contractABI, provider);
    document.getElementById('status').innerText = 'No wallet found, using read-only RPC';
  }
  aiSigner = new ethers.Wallet(AI_PRIVATE_KEY, provider);
}

// Add Monad Testnet
async function addMonadTestnet(){
  if(!window.ethereum) return alert('Wallet required');
  await window.ethereum.request({
    method:'wallet_addEthereumChain',
    params:[{
      chainId:'0x27bf',
      chainName:'Monad Testnet',
      rpcUrls:['https://testnet-rpc.monad.xyz'],
      nativeCurrency:{name:'MON',symbol:'MON',decimals:18},
      blockExplorerUrls:['https://testnet.monadexplorer.com']
    }]
  });
}

// === Blockchain move submission ===
async function submitMoveOnChain(moveSAN, color){
  if(!contract) return;
  try{
    const tx = await contract.connect(color==='w'?signer:aiSigner).submitMove(nextGameId, moveSAN);
    await tx.wait();
    console.log('Move submitted:', moveSAN);
  }catch(e){ console.error(e); }
}

// === AI move using Stockfish ===
const stockfish = STOCKFISH();
function aiMove(){
  if(game.game_over()) return;
  const moves = game.moves();
  const move = moves[Math.floor(Math.random()*moves.length)]; // Random for now
  game.move(move);
  board.position(game.fen());
  console.log('AI move:', move);
  submitMoveOnChain(move, aiColor);
}

// Reset board
function resetBoard(){ game.reset(); board.start(); }

// Start / Join Game
async function startGame(){
  if(!contract || !signer) await connectWallet();
  const tx = await contract.connect(signer).createGame();
  await tx.wait();
  alert('Game started!');
}

async function joinGame(){
  if(!contract || !signer) await connectWallet();
  const gameId = prompt('Enter Game ID:');
  if(gameId){
    await contract.connect(signer).joinGame(gameId);
    alert('Joined game!');
  }
}

// === Button events ===
document.getElementById('connectBtn').onclick = connectWallet;
document.getElementById('addNetworkBtn').onclick = addMonadTestnet;
document.getElementById('resetBtn').onclick = resetBoard;
document.getElementById('startBtn').onclick = startGame;
document.getElementById('joinBtn').onclick = joinGame;

</script>
</body>
</html>
