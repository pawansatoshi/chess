<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monad Chess DApp</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.1/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; margin: 0; }
    header { background: #111; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    header img { height: 40px; }
    h1 { margin: 20px 0; }
    #board { width: 350px; margin: 20px auto; }
    button { padding: 10px 20px; margin: 10px; font-size: 16px; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #ddd; }
    footer { background: #111; color: white; padding: 15px; margin-top: 30px; }
    footer a { color: #00acee; margin: 0 10px; text-decoration: none; }
  </style>
</head>
<body>

<header>
  <img src="fox_logo.png" alt="Fox Logo"/>
  <h2>MONAD</h2>
  <img src="monad_logo.png" alt="Monad Logo"/>
</header>

<h1>Monad Chess DApp <br>(AI Opponent)</h1>

<button id="connectBtn">Connect Wallet</button>
<button id="createGameBtn">Create Game</button>

<div id="board"></div>

<footer>
  <p>Follow me:</p>
  <a href="https://t.me/pawansatoshiji" target="_blank">Telegram</a> |
  <a href="https://youtube.com/@PawanSatoshi" target="_blank">YouTube</a> |
  <a href="https://x.com/pawansatoshix" target="_blank">Twitter</a> |
  <span>Discord: @pawansatoshi</span>
</footer>

<script>
  // Monad Testnet RPC
  const MONAD_RPC = "https://testnet-rpc.monad.xyz"; 
  let provider, signer;

  // Connect Wallet
  document.getElementById("connectBtn").addEventListener("click", async () => {
    try {
      if (window.ethereum) {
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        const address = await signer.getAddress();
        alert("Wallet Connected: " + address);
      } else {
        // fallback to Monad RPC (no metamask)
        provider = new ethers.JsonRpcProvider(MONAD_RPC);
        alert("Connected to Monad RPC (no wallet)");
      }
    } catch (err) {
      console.error(err);
      alert("Wallet connection error: " + err.message);
    }
  });

  // Create Game (Dummy for now)
  document.getElementById("createGameBtn").addEventListener("click", async () => {
    if (!signer) {
      alert("Connect wallet first!");
      return;
    }
    alert("Game created on Monad Testnet!");
    // TODO: integrate with deployed smart contract
  });

  // Chessboard + AI opponent
  const game = new Chess();
  const board = Chessboard('board', {
    draggable: true,
    position: 'start',
    onDrop: (source, target) => {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';
      setTimeout(makeAIMove, 250);
    }
  });

  function makeAIMove() {
    const possibleMoves = game.moves();
    if (game.game_over() || possibleMoves.length === 0) return;
    const move = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
    game.move(move);
    board.position(game.fen());
  }
</script>

</body>
</html>
